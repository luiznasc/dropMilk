<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Document</title>
</head>
<body id="body" onload="movePlane()">
    
    <script>
        const sleep = ms => new Promise(r => setTimeout(r, ms));
        async function dropMilk() {
            var plane = document.getElementById("plane");
            var body = document.getElementById("body");
            var milk = document.getElementById("milk");
            document.querySelector('button').disabled = true;
            planeTop = plane.getBoundingClientRect().top;
            milk.style.left  = plane.getBoundingClientRect().left;
            milk.style.display = "block";
            for (var i = planeTop; i < body.clientHeight - (2.5*milk.clientHeight); i++){
                await sleep();
                milk.style.top = i;
            }
            milk.style.display = "none";
            document.querySelector('button').disabled = false;
        }

        async function movePlane() {
            var plane = document.getElementById("plane");
            var body = document.getElementById("body");
            // for (var i = 0; i < (body.clientWidth - plane.clientWidth); i++) {
            //     await sleep(2);
            //     plane.style.left = i;
            // }
            var pos = 0;
            var lapCount = 0;
            while (true) {
                await sleep(2);
                plane.style.left=pos;
                pos = pos + 1;
                console.log(pos + ' 1');
                if (pos >= (body.clientWidth - plane.clientWidth)) {
                    lapCount = lapCount + 1;
                    pos = 0;
                    changeHeight();

                    if (!(lapCount%5)){
                        moveCat();
                    }
                }
                console.log(pos + ' 2');
                plane.style.left = pos;
            }
        }

        function changeHeight() {
            var plane = document.getElementById("plane");
            var body = document.getElementById("body");
            plane.style.top= Math.floor(Math.random() * (body.clientHeight/2)); //Only half to make it more consistent
        }

        function moveCat() {
            var body = document.getElementById("body");
            var cat = document.getElementById("pop-cat");
            // Some weird math for cat's position to prevent it from going too close
            // to the walls
            var catBox = Math.floor(Math.random() * (body.clientWidth - 2.5*cat.clientWidth));
            if (catBox < cat.clientWidth*2){
                catBox = cat.clientWidth*2;
            } else if (catBox > (body.clientWidth - (cat.clientWidth*2))) {
                catBox = body.clientWidth - (cat.clientWidth*2);
            }
            cat.style.left= catBox
        }

    </script> 
    <button onclick="dropMilk()" id="move-button">Drop Milk</button>

    <img src="plane.png" class="plane" id="plane">
    <img src="pop-cat.gif" class="pop-cat" id="pop-cat">
    <img src="milk.png" class="milk" id="milk">

</body>
</html>